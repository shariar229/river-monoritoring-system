<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <title>Karnaphuli River Water Quality and Contamination Monitoring System</title>

    <style>
      body,html{
          height:100%;
      }
      h3 {
        padding-top: 50px;
        padding-bottom: 30px;

      }

      img {
        width: 50%;
        border-radius: 10px;
        margin-bottom: 30px;
      }
    </style>
  </head>
  <body>
    <div class="container h-100">
      <h3 >Karnaphuli River Water Quality and Contamination Monitoring System</h3>
      <a class="d-flex justify-content-center" target="_blank" href="https://www.google.com/maps/place/Karnaphuli+River/data=!4m2!3m1!1s0x30ad4eb7bd5e778f:0x311064830b92c768?sa=X&ved=2ahUKEwjCkvGej5r5AhWO-jgGHQP8Dr8Q8gF6BAgIEAE">
        <img src="https://www.google.com/maps/vt/data=OlPAsXARmIUJ7luw5T14JyR7pBcJRgyj6HkMdHtjdJkbm1CTb4HDQtUwyii_O2Te82AIlGnoORp7QyFOQmOB3hyh8ZPT5fr4ZnM18ihI3cqtFD_azVZQqQxtIQkYYupQa_WUAoSlbf3_V5S64xc49GvlaqZ_BO4Nzw6JMIzzk_l4iRS4TN-ppjiiKTiTS1TujZ8mYRZkdiDYr2bA9UZk8PMEyIfhgzjgGJrU_KwLk_brwPCrkSh3FyL9" alt="">

      </a>
      <table class="table" id="table">
        <thead class="thead-light">
          <tr>
            <th scope="col">pH</th>
            <th scope="col">Turbidity</th>
            <th scope="col">Temperature</th>
            <th scope="col">TDS</th>
            <!-- <th scope="col">Time</th>
            <th scope="col">#</th> -->
          </tr>
        </thead>
        <tbody>
          <tr id="inputRow" style="display: none;">
            <td >
              <input type="text" name="ph" value="25">
            </td>
            <td >
              <input type="text" name="turbidity" value="25">
            </td>
            <td >
              <input type="text" name="temp" value="25">
            </td>
            <td >
              <input type="text" name="tds" value="25">
            </td>
            <td>
              <button id="insert">Add</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
      
    
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-app.js";
        import { getDatabase, set, ref ,push, child, onValue} from "https://www.gstatic.com/firebasejs/9.9.1/firebase-database.js";
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyB4jXTqNsS9jfG5WdVvqwLEm4P9rBZt_6c",
          authDomain: "karnaphuli.firebaseapp.com",
          databaseURL: "https://karnaphuli-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "karnaphuli",
          storageBucket: "karnaphuli.appspot.com",
          messagingSenderId: "297528777104",
          appId: "1:297528777104:web:29ef6186abdbdae0ef3b15"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const params = new URLSearchParams(window.location.search)
        function deleteData(id) {
          console.log(id);
          // remove(ref(database, 'qualities/' + id)).then(() => console.log('deleted')).then((error) => console.log(error))
        }

        function getData() {
          const dbRef = ref(database, 'qualities/');
          onValue(dbRef, (snapshot) => {
            let rowNum = 0; 
            snapshot.forEach((childSnapshot, index) => { 
              let childData = childSnapshot.val()
              let row = "<tr><td>" + childData.ph + "</td><td>" + childData.turbidity + "</td><td>" + childData.temp +  "</td><td>" + childData.tds + "</td></tr>"
              $(row).appendTo('#table');
              rowNum += 1
            })}, {onlyOnce: true})
        }
        getData()

        function insertData() {
          const row = document.querySelector('#inputRow')
          const params = row.querySelectorAll('td input')
          const data = {}
          
          for (let index = 0; index < params.length; index++) {
            const element = params[index];
            const key = element.getAttribute('name')
            const value = element.value ? element.value : '--'
            data[key] = value
          }

          const newPostKey = push(child(ref(database), 'qualities')).key
          set(ref(database, 'qualities/' + newPostKey), data)
        }

        
        
        insert.addEventListener('click', (e) => {
          insertData()
        })
        
        window.addEventListener('DOMContentLoaded', (event) => {
          let inputRow = document.querySelector('tr#inputRow')
          if(params.has('admin')) {
            inputRow.display = 'block!important'
          } else {
            inputRow.display = 'none!important'
          }
        });
      </script>
  </body>
</html>
