<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <title>Karnaphuli River Water Quality and Contamination Monitoring System</title>

  <style>
    body,
    html {
      height: 100%;
    }

    h3 {
      padding-top: 50px;
      padding-bottom: 30px;
      text-align: center;
    }

    img {
      width: 50%;
      border-radius: 10px;
      margin-bottom: 30px;
    }

    td:not(:first-child), th:not(:first-child) {
      text-align: center;
    }

    .highlight {
      color: red;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="container h-100 d-none" id="app">
    <h3>Karnaphuli River Water Quality and Contamination Monitoring System</h3>
    <a class="d-flex justify-content-center" target="_blank"
      href="https://www.google.com/maps/place/Karnaphuli+River/data=!4m2!3m1!1s0x30ad4eb7bd5e778f:0x311064830b92c768?sa=X&ved=2ahUKEwjCkvGej5r5AhWO-jgGHQP8Dr8Q8gF6BAgIEAE">
      <img
        src="https://www.google.com/maps/vt/data=OlPAsXARmIUJ7luw5T14JyR7pBcJRgyj6HkMdHtjdJkbm1CTb4HDQtUwyii_O2Te82AIlGnoORp7QyFOQmOB3hyh8ZPT5fr4ZnM18ihI3cqtFD_azVZQqQxtIQkYYupQa_WUAoSlbf3_V5S64xc49GvlaqZ_BO4Nzw6JMIzzk_l4iRS4TN-ppjiiKTiTS1TujZ8mYRZkdiDYr2bA9UZk8PMEyIfhgzjgGJrU_KwLk_brwPCrkSh3FyL9">

    </a>


    <table class="table" id="table">
      <thead class="thead-light">
        <tr>
          <th scope="col">#</th>
          <th scope="col">pH</th>
          <th scope="col">Turbidity</th>
          <th scope="col">Temperature</th>
          <th scope="col">TDS</th>
          <!-- <th scope="col">Time</th>
            <th scope="col">#</th> -->
        </tr>
      </thead>
      <tbody>

        <tr v-for="(item, i) in items">
          <td> {{ i + 1 }} </td>
          <td :class="{'highlight': item.ph > ST_VALUE.ph}"> {{ item.ph }} </td>
          <td :class="{'highlight': item.turbidity > ST_VALUE.turbidity}"> {{ item.turbidity }} </td>
          <td :class="{'highlight': item.temp > ST_VALUE.temp}"> {{ item.temp }} </td>
          <td :class="{'highlight': item.tds > ST_VALUE.tds}"> {{ item.tds }} </td>
        </tr>

        <tr v-if="isAdmin">
          <td></td>
          <td>
            <input type="text" class="form-control" v-model="newItem.ph">
          </td>
          <td>
            <input type="text" class="form-control" v-model="newItem.turbidity">
          </td>
          <td>
            <input type="text" class="form-control" v-model="newItem.temp">
          </td>
          <td>
            <input type="text" class="form-control" v-model="newItem.tds">
          </td>
          <td>
            <button class="btn btn-primary" @click="insertData()">Add</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.37/vue.global.min.js"></script>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-app.js";
    import { getDatabase, set, ref as Ref, push, child, onValue } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyANjfshIZtv7EOL9i6yYAYHhDOTmg77Ljc",
      authDomain: "test-1-7479d.firebaseapp.com",
      databaseURL: "https://test-1-7479d-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "test-1-7479d",
      storageBucket: "test-1-7479d.appspot.com",
      messagingSenderId: "232532347852",
      appId: "1:232532347852:web:b6cc1965de5b9dfcdcab69"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const params = new URLSearchParams(window.location.search)

    const { ref, createApp } = Vue

    createApp({
      setup() {

        const isAdmin = ref(false)
        const items = ref([])
        const ST_VALUE = {
          ph: 5,
          temp: 26,
          tds: 50,
          turbidity: 300
        }
        const newItem = ref(ST_VALUE)

        if (params.has('admin')) {
          isAdmin.value = true
        }

        const getData = () => {
          const dbRef = Ref(database, 'qualities/');
          onValue(dbRef, (snapshot) => {
            snapshot.forEach((childSnapshot, index) => {
              let childData = childSnapshot.val()
              items.value.push(childData)
            })
          }, { onlyOnce: true })
        }

        const insertData = () => {
          console.log(newItem.value)
          const newPostKey = push(child(ref(database), 'qualities')).key
          set(ref(database, 'qualities/' + newPostKey), newItem)
        }

        const deleteData = (id) => {
          console.log(id);
          // remove(Ref(database, 'qualities/' + id)).then(() => console.log('deleted')).then((error) => console.log(error))
        }

        getData()

        return {
          isAdmin,
          items,
          ST_VALUE,
          newItem,
          insertData,
        }
      }
    }).mount('#app')

    document.querySelector('#app').classList.remove('d-none')

  </script>
</body>

</html>